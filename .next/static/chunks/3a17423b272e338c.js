(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,47152,e=>{"use strict";var a=e.i(96564),t=e.i(55528);e.s(["instructoresService",0,{async getAll(e){let{data:r}=await a.apiClient.get(t.API_ENDPOINTS.instructores,e);if(r&&"object"==typeof r&&"success"in r&&r.data){let e=r.data;return Array.isArray(e)?{data:e,total:e.length,current_page:1,last_page:1,per_page:e.length,from:1,to:e.length}:e}return Array.isArray(r)?{data:r,total:r.length,current_page:1,last_page:1,per_page:r.length,from:1,to:r.length}:r},async getDisponibles(){let{data:e}=await a.apiClient.get(`${t.API_ENDPOINTS.instructores}/disponibles/listar`);return e&&"object"==typeof e&&"instructores"in e?e.instructores.map(e=>({id_usuario:e.id_usuario||e.id_instructor||0,nombre:e.nombres||e.nombre||"",apellido:e.apellidos||e.apellido||"",email:e.email||"",especialidad:e.especialidad,status:"activo",id_rol:0,created_at:"",updated_at:""})):e&&"object"==typeof e&&"data"in e?e.data:e}},"rolesService",0,{async getAll(){console.log("Llamando a:",t.API_ENDPOINTS.roles);let{data:e}=await a.apiClient.get(t.API_ENDPOINTS.roles);return console.log("Respuesta roles:",e),Array.isArray(e)?e:e.data},async getById(e){let{data:r}=await a.apiClient.get(`${t.API_ENDPOINTS.roles}/${e}`);return r},async create(e){let{data:r}=await a.apiClient.post(t.API_ENDPOINTS.roles,e);return r.data},async update(e,r){let{data:s}=await a.apiClient.put(`${t.API_ENDPOINTS.roles}/${e}`,r);return s.data},async delete(e){await a.apiClient.delete(`${t.API_ENDPOINTS.roles}/${e}`)}},"usuariosService",0,{async getAll(e){let{data:r}=await a.apiClient.get(t.API_ENDPOINTS.usuarios,e);if(r&&"object"==typeof r&&"success"in r&&r.data){let e=r.data;return Array.isArray(e)?{data:e,total:e.length,current_page:1,last_page:1,per_page:e.length,from:1,to:e.length}:e}return Array.isArray(r)?{data:r,total:r.length,current_page:1,last_page:1,per_page:r.length,from:1,to:r.length}:r},async getById(e){let{data:r}=await a.apiClient.get(`${t.API_ENDPOINTS.usuarios}/${e}`);return r},async create(e){let{data:r}=await a.apiClient.post(t.API_ENDPOINTS.usuarios,e);return r},async update(e,r){let{data:s}=await a.apiClient.put(`${t.API_ENDPOINTS.usuarios}/${e}`,r);return s},async delete(e){await a.apiClient.delete(`${t.API_ENDPOINTS.usuarios}/${e}`)},async cambiarEstado(e,r){let{data:s}=await a.apiClient.put(`${t.API_ENDPOINTS.usuarios}/${e}/estado`,{status:r});return s}}])},14867,e=>{"use strict";var a=e.i(96564),t=e.i(55528);e.s(["facturasService",0,{async getAll(e){let{data:r}=await a.apiClient.get(t.API_ENDPOINTS.facturas,e);if(r&&"object"==typeof r&&"success"in r&&r.data){let e=r.data;return Array.isArray(e)?{data:e,total:e.length,current_page:1,last_page:1,per_page:e.length,from:1,to:e.length}:e}return Array.isArray(r)?{data:r,total:r.length,current_page:1,last_page:1,per_page:r.length,from:1,to:r.length}:r},async getById(e){let{data:r}=await a.apiClient.get(`${t.API_ENDPOINTS.facturas}/${e}`);return r},async create(e){let{data:r}=await a.apiClient.post(t.API_ENDPOINTS.facturas,e);return r},async update(e,r){let{data:s}=await a.apiClient.put(`${t.API_ENDPOINTS.facturas}/${e}`,r);return s},async delete(e){await a.apiClient.delete(`${t.API_ENDPOINTS.facturas}/${e}`)},async cambiarEstado(e,r){let{data:s}=await a.apiClient.put(`${t.API_ENDPOINTS.facturas}/${e}`,{estado:r});return s},async registrarPago(e,r){let{data:s}=await a.apiClient.post(`${t.API_ENDPOINTS.facturas}/${e}/registrar-pago`,r);return s},async generarDesdeInscripcion(e,r){let{data:s}=await a.apiClient.post(`${t.API_ENDPOINTS.facturas}/generar-desde-inscripcion/${e}`,{id_tutor:r});return s},async getFacturasPorTutor(e){let{data:r}=await a.apiClient.get(`${t.API_ENDPOINTS.facturas}/tutor/${e}`);return r},async getReporteFacturacion(e){let{data:r}=await a.apiClient.get(`${t.API_ENDPOINTS.facturas}/reporte/facturacion`,e);return r},async getDatosParaPdf(e){let{data:r}=await a.apiClient.get(`${t.API_ENDPOINTS.facturas}/${e}/pdf`);return r}},"pagosService",0,{async getAll(e){let{data:r}=await a.apiClient.get(t.API_ENDPOINTS.pagos,e);if(r&&"object"==typeof r&&"success"in r&&r.data){let e=r.data;return Array.isArray(e)?{data:e,total:e.length,current_page:1,last_page:1,per_page:e.length,from:1,to:e.length}:e}return Array.isArray(r)?{data:r,total:r.length,current_page:1,last_page:1,per_page:r.length,from:1,to:r.length}:r},async getById(e){let{data:r}=await a.apiClient.get(`${t.API_ENDPOINTS.pagos}/${e}`);return r},async update(e,r){let{data:s}=await a.apiClient.put(`${t.API_ENDPOINTS.pagos}/${e}`,r);return s},async delete(e){await a.apiClient.delete(`${t.API_ENDPOINTS.pagos}/${e}`)},async verificar(e){let{data:r}=await a.apiClient.post(`${t.API_ENDPOINTS.pagos}/${e}/verificar`);return r},async rechazar(e,r){let{data:s}=await a.apiClient.post(`${t.API_ENDPOINTS.pagos}/${e}/rechazar`,{motivo:r});return s}}])},65258,e=>{"use strict";var a=e.i(44472),t=e.i(30680),r=e.i(96833);e.i(51766);var s=e.i(5174);e.i(36106);var i=e.i(75650),n=e.i(75227),o=e.i(13762),l=e.i(80028),c=e.i(14867),u=e.i(47152);function d(){let e=(0,r.useRouter)(),d=Number((0,r.useParams)().id),[p,g]=(0,t.useState)(!1),[m,_]=(0,t.useState)(!0),[h,y]=(0,t.useState)(""),[I,N]=(0,t.useState)([]),[b,f]=(0,t.useState)({numero:"",id_tutor:"",concepto:"",subtotal:"",descuento:"",impuesto:"",fecha_emision:"",fecha_vencimiento:"",observaciones:"",estado:"pendiente"});(0,t.useEffect)(()=>{(async()=>{try{let[e,a]=await Promise.all([c.facturasService.getById(d),u.usuariosService.getAll({per_page:100,rol:"tutor"})]);N(a.data),f({numero:e.numero_factura||"",id_tutor:e.id_tutor?String(e.id_tutor):"",concepto:e.concepto||"",subtotal:String(e.subtotal||""),descuento:e.descuento?String(e.descuento):"",impuesto:e.impuesto?String(e.impuesto):"",fecha_emision:e.fecha_emision||"",fecha_vencimiento:e.fecha_vencimiento||"",observaciones:e.observaciones||"",estado:e.estado||"pendiente"})}catch(e){y("Error al cargar la factura"),console.error(e)}finally{_(!1)}})()},[d]);let P=e=>{let{name:a,value:t}=e.target;f(e=>({...e,[a]:t}))},v=()=>(parseFloat(b.subtotal)||0)-(parseFloat(b.descuento)||0)+(parseFloat(b.impuesto)||0),A=async a=>{a.preventDefault(),g(!0),y("");try{await c.facturasService.update(d,{numero:b.numero,id_tutor:b.id_tutor?parseInt(b.id_tutor):void 0,concepto:b.concepto,subtotal:parseFloat(b.subtotal)||0,descuento:b.descuento?parseFloat(b.descuento):void 0,impuesto:b.impuesto?parseFloat(b.impuesto):void 0,total:v(),fecha_emision:b.fecha_emision,fecha_vencimiento:b.fecha_vencimiento||void 0,observaciones:b.observaciones||void 0,estado:b.estado}),e.push("/finanzas/facturas")}catch(e){y(e instanceof Error?e.message:"Error al actualizar")}finally{g(!1)}};return m?(0,a.jsx)(s.DashboardLayout,{children:(0,a.jsx)("div",{className:"flex justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):(0,a.jsx)(s.DashboardLayout,{children:(0,a.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{children:(0,a.jsx)(i.CardTitle,{children:"Editar Factura"})}),(0,a.jsxs)(i.CardContent,{children:[h&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:h}),(0,a.jsxs)("form",{onSubmit:A,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(o.Input,{label:"Número de Factura",name:"numero",value:b.numero,onChange:P,required:!0}),(0,a.jsx)(l.Select,{label:"Cliente (Tutor)",name:"id_tutor",value:b.id_tutor,onChange:P,placeholder:"Seleccionar",options:I.map(e=>({value:e.id_usuario,label:`${e.nombre} ${e.apellido}`}))})]}),(0,a.jsx)(o.Input,{label:"Concepto",name:"concepto",value:b.concepto,onChange:P,required:!0}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsx)(o.Input,{label:"Subtotal ($)",name:"subtotal",type:"number",step:"0.01",value:b.subtotal,onChange:P,required:!0}),(0,a.jsx)(o.Input,{label:"Descuento ($)",name:"descuento",type:"number",step:"0.01",value:b.descuento,onChange:P}),(0,a.jsx)(o.Input,{label:"Impuesto ($)",name:"impuesto",type:"number",step:"0.01",value:b.impuesto,onChange:P})]}),(0,a.jsx)("div",{className:"p-3 bg-gray-100 rounded",children:(0,a.jsxs)("p",{className:"text-lg font-bold",children:["Total: $",v().toFixed(2)]})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(o.Input,{label:"Fecha Emisión",name:"fecha_emision",type:"date",value:b.fecha_emision,onChange:P,required:!0}),(0,a.jsx)(o.Input,{label:"Fecha Vencimiento",name:"fecha_vencimiento",type:"date",value:b.fecha_vencimiento,onChange:P})]}),(0,a.jsx)(l.Select,{label:"Estado",name:"estado",value:b.estado,onChange:P,options:[{value:"pendiente",label:"Pendiente"},{value:"pagada",label:"Pagada"},{value:"anulada",label:"Anulada"},{value:"vencida",label:"Vencida"}]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observaciones"}),(0,a.jsx)("textarea",{name:"observaciones",value:b.observaciones,onChange:P,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,a.jsx)(n.Button,{type:"button",variant:"secondary",onClick:()=>e.back(),children:"Cancelar"}),(0,a.jsx)(n.Button,{type:"submit",disabled:p,children:p?"Guardando...":"Guardar Cambios"})]})]})]})]})})})}e.s(["default",()=>d])}]);